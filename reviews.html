<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Up Front Auto Repair â€” Review Manager</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:          #0f1117;
  --surface:     #1a1d27;
  --surface2:    #1e2130;
  --surface3:    #242840;
  --border:      #2a2d3a;
  --border2:     #353850;
  --red:         #e63946;
  --red-dark:    #c1121f;
  --red-glow:    rgba(230,57,70,0.35);
  --green:       #2ecc71;
  --green-dim:   rgba(46,204,113,0.15);
  --amber:       #f39c12;
  --amber-dim:   rgba(243,156,18,0.15);
  --blue:        #3b82f6;
  --blue-dim:    rgba(59,130,246,0.15);
  --purple:      #8b5cf6;
  --purple-dim:  rgba(139,92,246,0.15);
  --text:        #ffffff;
  --text2:       #c9cad4;
  --text3:       #8b8d97;
  --text4:       #555770;
  --radius:      12px;
  --radius-sm:   8px;
  --shadow:      0 8px 32px rgba(0,0,0,0.4);
  --shadow-lg:   0 20px 60px rgba(0,0,0,0.6);
  --transition:  all 0.2s cubic-bezier(0.4,0,0.2,1);
  --sidebar-w:   68px;
  --header-h:    64px;
}
html,body{height:100%;overflow:hidden;font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.shell{display:flex;height:100vh;overflow:hidden}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar{
  width:var(--sidebar-w);
  background:var(--surface);
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:16px 0;
  gap:4px;
  flex-shrink:0;
  z-index:100;
}
.sidebar-logo{
  width:40px;height:40px;
  background:linear-gradient(135deg,var(--red),var(--red-dark));
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.2rem;
  margin-bottom:20px;
  box-shadow:0 4px 16px var(--red-glow);
}
.nav-item{
  width:44px;height:44px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  font-size:1.2rem;
  cursor:pointer;
  transition:var(--transition);
  position:relative;
  color:var(--text3);
  border:none;background:transparent;
}
.nav-item:hover{background:var(--surface3);color:var(--text)}
.nav-item.active{background:rgba(230,57,70,0.15);color:var(--red)}
.nav-item.active::before{
  content:'';position:absolute;left:-1px;top:50%;
  transform:translateY(-50%);
  width:3px;height:24px;
  background:var(--red);
  border-radius:0 4px 4px 0;
}
.nav-tooltip{
  position:absolute;left:calc(100% + 12px);
  background:#111;color:var(--text);
  padding:6px 12px;border-radius:6px;
  font-size:0.75rem;font-weight:600;
  white-space:nowrap;
  opacity:0;pointer-events:none;
  transition:opacity 0.15s;
  box-shadow:var(--shadow);
  border:1px solid var(--border);
  z-index:200;
}
.nav-item:hover .nav-tooltip{opacity:1}
.sidebar-spacer{flex:1}
.sidebar-version{font-size:0.6rem;color:var(--text4);letter-spacing:1px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden}

/* â”€â”€ HEADER â”€â”€ */
.header{
  height:var(--header-h);
  background:var(--surface);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 28px;gap:20px;
  flex-shrink:0;
  z-index:50;
}
.header-brand{display:flex;flex-direction:column}
.header-name{
  font-size:0.95rem;font-weight:800;
  letter-spacing:2px;text-transform:uppercase;
  line-height:1.1;
}
.header-name em{color:var(--red);font-style:normal}
.header-sub{font-size:0.68rem;color:var(--text3);letter-spacing:1.5px;text-transform:uppercase;margin-top:2px}
.header-divider{width:1px;height:32px;background:var(--border);margin:0 4px}
.header-panel-name{font-size:0.85rem;font-weight:600;color:var(--text3)}
.header-spacer{flex:1}
.header-status{
  display:flex;align-items:center;gap:8px;
  font-size:0.8rem;font-weight:500;color:var(--text3);
}
.status-dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--green);
  box-shadow:0 0 8px var(--green);
  animation:pulse 2s infinite;
}
.status-dot.offline{background:#ef4444;box-shadow:0 0 8px #ef4444;animation:none}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.header-clock{
  font-size:0.85rem;font-weight:600;color:var(--text2);
  font-variant-numeric:tabular-nums;
}

/* â”€â”€ CONTENT â”€â”€ */
.content{flex:1;overflow-y:auto;padding:28px}
.content::-webkit-scrollbar{width:6px}
.content::-webkit-scrollbar-track{background:transparent}
.content::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}

/* â”€â”€ PANELS â”€â”€ */
.panel{display:none;animation:fadeSlideUp 0.35s cubic-bezier(0.4,0,0.2,1)}
.panel.active{display:block}
@keyframes fadeSlideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEND PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.send-wrap{
  max-width:520px;margin:0 auto;
  display:flex;flex-direction:column;gap:0;
}
.send-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
  padding:36px 40px;
  box-shadow:var(--shadow-lg);
  position:relative;
  overflow:hidden;
}
.send-card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:3px;
  background:linear-gradient(90deg,var(--red),#ff6b6b);
}
.send-title{
  font-size:1.25rem;font-weight:700;color:var(--text);
  margin-bottom:8px;
}
.send-subtitle{font-size:0.83rem;color:var(--text3);margin-bottom:32px}

/* Floating labels */
.float-group{position:relative;margin-bottom:24px}
.float-input,.float-select{
  width:100%;
  background:var(--surface2);
  border:1.5px solid var(--border2);
  border-radius:var(--radius-sm);
  color:var(--text);
  font-family:'Inter',sans-serif;
  font-size:0.95rem;
  font-weight:500;
  padding:22px 16px 8px;
  transition:var(--transition);
  outline:none;
  appearance:none;
  -webkit-appearance:none;
}
.float-input:focus,.float-select:focus{
  border-color:var(--red);
  background:var(--surface3);
  box-shadow:0 0 0 3px rgba(230,57,70,0.12);
}
.float-input::placeholder{color:transparent}
.float-label{
  position:absolute;left:16px;top:50%;transform:translateY(-50%);
  font-size:0.9rem;font-weight:500;color:var(--text3);
  pointer-events:none;transition:var(--transition);
  transform-origin:left top;
}
.float-input:focus~.float-label,
.float-input:not(:placeholder-shown)~.float-label,
.float-select.has-value~.float-label{
  top:10px;transform:none;font-size:0.68rem;font-weight:600;
  color:var(--red);letter-spacing:0.5px;text-transform:uppercase;
}

/* Custom select wrapper */
.select-wrap{position:relative}
.select-wrap::after{
  content:'';position:absolute;right:16px;top:50%;transform:translateY(-50%);
  width:0;height:0;
  border-left:5px solid transparent;
  border-right:5px solid transparent;
  border-top:5px solid var(--text3);
  pointer-events:none;
  transition:var(--transition);
}
.float-select{cursor:pointer;padding-right:40px}
.float-select option{background:var(--surface2);color:var(--text)}

/* Send button */
.send-btn{
  width:100%;margin-top:8px;
  padding:17px;
  background:linear-gradient(135deg,var(--red) 0%,#ff4757 100%);
  color:white;border:none;
  border-radius:var(--radius-sm);
  font-family:'Inter',sans-serif;
  font-size:1rem;font-weight:700;
  letter-spacing:1px;text-transform:uppercase;
  cursor:pointer;
  transition:var(--transition);
  position:relative;overflow:hidden;
  box-shadow:0 4px 20px var(--red-glow);
}
.send-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,rgba(255,255,255,0.1),transparent);
  opacity:0;transition:opacity 0.2s;
}
.send-btn:hover{
  transform:translateY(-1px);
  box-shadow:0 8px 32px var(--red-glow);
}
.send-btn:hover::before{opacity:1}
.send-btn:active{transform:translateY(0) scale(0.98);box-shadow:0 2px 8px var(--red-glow)}
.send-btn:disabled{
  background:var(--surface3);color:var(--text4);
  box-shadow:none;cursor:not-allowed;transform:none;
}

/* Success state */
.success-state{
  display:none;text-align:center;padding:20px 0;
  animation:fadeSlideUp 0.4s cubic-bezier(0.4,0,0.2,1);
}
.success-state.show{display:block}
.success-icon{
  font-size:4rem;margin-bottom:16px;
  animation:successPop 0.5s cubic-bezier(0.175,0.885,0.32,1.275);
}
@keyframes successPop{from{transform:scale(0)}to{transform:scale(1)}}
.success-name{font-size:1.5rem;font-weight:800;color:var(--text);margin-bottom:8px}
.success-msg{font-size:0.88rem;color:var(--text3);margin-bottom:28px}
.send-another-btn{
  padding:12px 28px;
  background:transparent;
  border:1.5px solid var(--border2);
  border-radius:var(--radius-sm);
  color:var(--text2);font-family:'Inter',sans-serif;
  font-size:0.88rem;font-weight:600;
  cursor:pointer;transition:var(--transition);
}
.send-another-btn:hover{border-color:var(--text3);color:var(--text)}

/* Error banner */
.error-banner{
  background:rgba(230,57,70,0.1);
  border:1px solid rgba(230,57,70,0.3);
  border-radius:var(--radius-sm);
  padding:12px 16px;
  font-size:0.83rem;color:#ff6b6b;font-weight:500;
  margin-top:16px;display:none;
}
.error-banner.show{display:block}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dash-layout{display:flex;gap:24px;align-items:flex-start}
.dash-main{flex:1;min-width:0;display:flex;flex-direction:column;gap:20px}
.dash-aside{width:300px;flex-shrink:0}

/* Stat cards */
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
.stat-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:22px 20px;
  position:relative;overflow:hidden;
  transition:var(--transition);
  animation:fadeSlideUp 0.4s cubic-bezier(0.4,0,0.2,1) both;
}
.stat-card:nth-child(1){animation-delay:0.05s}
.stat-card:nth-child(2){animation-delay:0.1s}
.stat-card:nth-child(3){animation-delay:0.15s}
.stat-card:nth-child(4){animation-delay:0.2s}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
.stat-glow{
  position:absolute;top:-30px;right:-30px;
  width:120px;height:120px;border-radius:50%;
  opacity:0.12;pointer-events:none;
}
.stat-card-blue   .stat-glow{background:var(--blue)}
.stat-card-gold   .stat-glow{background:#f59e0b}
.stat-card-orange .stat-glow{background:#f97316}
.stat-card-green  .stat-glow{background:var(--green)}
.stat-icon{font-size:1.5rem;margin-bottom:12px}
.stat-value{
  font-size:2.4rem;font-weight:800;color:var(--text);
  line-height:1;font-variant-numeric:tabular-nums;
}
.stat-label{font-size:0.75rem;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:1px;margin-top:6px}
.stat-card-blue   .stat-value{color:#60a5fa}
.stat-card-gold   .stat-value{color:#fbbf24}
.stat-card-orange .stat-value{color:#fb923c}
.stat-card-green  .stat-value{color:var(--green)}

/* Table card */
.table-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
}
.table-header{
  padding:18px 24px;
  display:flex;align-items:center;justify-content:space-between;
  border-bottom:1px solid var(--border);
  gap:12px;flex-wrap:wrap;
}
.table-title{font-size:0.95rem;font-weight:700;color:var(--text)}
.table-meta{font-size:0.75rem;color:var(--text4);margin-top:2px}
.table-actions{display:flex;gap:8px;align-items:center}
.btn-sm{
  padding:7px 14px;border-radius:6px;
  font-family:'Inter',sans-serif;font-size:0.78rem;font-weight:600;
  cursor:pointer;border:none;transition:var(--transition);letter-spacing:0.3px;
}
.btn-ghost{background:transparent;border:1px solid var(--border2);color:var(--text3)}
.btn-ghost:hover{border-color:var(--text3);color:var(--text)}
.btn-primary{background:var(--red);color:white}
.btn-primary:hover{background:var(--red-dark)}

table{width:100%;border-collapse:collapse}
thead th{
  padding:12px 20px;text-align:left;
  font-size:0.7rem;font-weight:700;color:var(--text3);
  text-transform:uppercase;letter-spacing:1.2px;
  background:rgba(0,0,0,0.2);border-bottom:1px solid var(--border);
  white-space:nowrap;
}
tbody tr{
  border-bottom:1px solid var(--border);
  transition:background 0.15s;
  animation:fadeSlideUp 0.3s cubic-bezier(0.4,0,0.2,1) both;
}
tbody tr:nth-child(even){background:rgba(255,255,255,0.015)}
tbody tr:hover{background:rgba(59,130,246,0.07)}
tbody tr:last-child{border-bottom:none}
tbody td{
  padding:14px 20px;vertical-align:middle;
  font-size:0.88rem;color:var(--text2);
}
.td-name{font-weight:700;color:var(--text)}
.td-phone{font-family:monospace;font-size:0.83rem;color:var(--text3)}
.td-date{font-size:0.8rem;color:var(--text4)}

/* Badges */
.badge{
  display:inline-flex;align-items:center;gap:5px;
  padding:4px 11px;border-radius:20px;
  font-size:0.72rem;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;
  white-space:nowrap;
}
.badge-pending   {background:rgba(243,156,18,0.15);color:#fbbf24;border:1px solid rgba(243,156,18,0.25)}
.badge-followed  {background:rgba(59,130,246,0.15);color:#60a5fa;border:1px solid rgba(59,130,246,0.25)}
.badge-reviewed  {background:rgba(46,204,113,0.15);color:var(--green);border:1px solid rgba(46,204,113,0.25)}
.badge-noresponse{background:rgba(139,92,246,0.12);color:#a78bfa;border:1px solid rgba(139,92,246,0.2)}

.mark-btn{
  padding:6px 12px;border-radius:6px;
  background:rgba(46,204,113,0.1);color:var(--green);
  border:1px solid rgba(46,204,113,0.25);
  font-family:'Inter',sans-serif;font-size:0.75rem;font-weight:700;
  cursor:pointer;transition:var(--transition);white-space:nowrap;
}
.mark-btn:hover{background:rgba(46,204,113,0.2);border-color:rgba(46,204,113,0.4)}
.mark-btn:disabled{opacity:0.35;cursor:not-allowed;background:transparent}

.table-empty{text-align:center;padding:60px 20px}
.table-empty-icon{font-size:2.5rem;margin-bottom:12px;opacity:0.4}
.table-empty-msg{font-size:0.9rem;font-weight:600;color:var(--text3)}
.table-empty-sub{font-size:0.8rem;color:var(--text4);margin-top:6px}

/* Activity feed */
.activity-card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  overflow:hidden;
}
.activity-header{
  padding:16px 20px;
  border-bottom:1px solid var(--border);
  font-size:0.88rem;font-weight:700;color:var(--text);
  display:flex;align-items:center;justify-content:space-between;
}
.activity-list{max-height:520px;overflow-y:auto}
.activity-list::-webkit-scrollbar{width:4px}
.activity-list::-webkit-scrollbar-thumb{background:var(--border2);border-radius:2px}
.activity-item{
  padding:14px 20px;border-bottom:1px solid var(--border);
  animation:fadeSlideUp 0.3s cubic-bezier(0.4,0,0.2,1) both;
}
.activity-item:last-child{border-bottom:none}
.activity-text{font-size:0.82rem;color:var(--text2);font-weight:500;line-height:1.4}
.activity-time{font-size:0.72rem;color:var(--text4);margin-top:4px}
.activity-dot{
  display:inline-block;width:6px;height:6px;border-radius:50%;
  margin-right:6px;vertical-align:middle;flex-shrink:0;
}
.dot-green{background:var(--green)}
.dot-blue{background:var(--blue)}
.dot-amber{background:var(--amber)}
.dot-gray{background:var(--text4)}
.activity-empty{padding:40px 20px;text-align:center;color:var(--text4);font-size:0.82rem}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CUSTOMERS PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.customers-wrap{display:flex;flex-direction:column;gap:20px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-wrap{max-width:580px;display:flex;flex-direction:column;gap:20px}
.settings-card{
  background:var(--surface);border:1px solid var(--border);
  border-radius:var(--radius);padding:28px 32px;
}
.settings-card h3{font-size:1rem;font-weight:700;color:var(--text);margin-bottom:6px}
.settings-card p{font-size:0.82rem;color:var(--text3);margin-bottom:24px;line-height:1.5}
.settings-row{display:flex;gap:12px;align-items:flex-end;margin-bottom:16px}
.settings-row .float-group{flex:1;margin-bottom:0}
.ping-result{
  font-size:0.82rem;font-weight:600;padding:12px 16px;
  border-radius:var(--radius-sm);margin-top:12px;
  display:none;
}
.ping-result.ok{background:rgba(46,204,113,0.1);color:var(--green);border:1px solid rgba(46,204,113,0.2);display:block}
.ping-result.fail{background:rgba(230,57,70,0.1);color:#ff6b6b;border:1px solid rgba(230,57,70,0.2);display:block}
.config-display{
  background:rgba(0,0,0,0.3);border-radius:var(--radius-sm);
  padding:14px 16px;font-family:monospace;font-size:0.82rem;
  color:var(--text3);border:1px solid var(--border);
  line-height:1.8;
}
.config-key{color:var(--text4)}
.config-val{color:#60a5fa}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.confetti-canvas{
  position:fixed;top:0;left:0;width:100%;height:100%;
  pointer-events:none;z-index:9999;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR OFFSET FOR WIDE SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:1100px){
  .dash-aside{display:none}
  .stats-row{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:680px){
  .content{padding:16px}
  .send-card{padding:24px 20px}
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .table-header{gap:8px}
}
</style>
</head>
<body>

<canvas class="confetti-canvas" id="confettiCanvas"></canvas>

<div class="shell">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDEBAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <nav class="sidebar">
    <div class="sidebar-logo">ğŸ”§</div>

    <button class="nav-item active" onclick="switchPanel('send')" id="nav-send" title="Send Request">
      ğŸ“¤<span class="nav-tooltip">Send Request</span>
    </button>
    <button class="nav-item" onclick="switchPanel('dashboard')" id="nav-dashboard">
      ğŸ“Š<span class="nav-tooltip">Dashboard</span>
    </button>
    <button class="nav-item" onclick="switchPanel('customers')" id="nav-customers">
      ğŸ‘¥<span class="nav-tooltip">All Customers</span>
    </button>
    <button class="nav-item" onclick="switchPanel('settings')" id="nav-settings">
      âš™ï¸<span class="nav-tooltip">Settings</span>
    </button>

    <div class="sidebar-spacer"></div>
    <div class="sidebar-version">v2.0</div>
  </nav>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="main">

    <!-- HEADER -->
    <header class="header">
      <div class="header-brand">
        <div class="header-name">Up Front <em>Auto</em> Repair</div>
        <div class="header-sub">Pittsfield, ME Â· (207) 648-4747</div>
      </div>
      <div class="header-divider"></div>
      <div class="header-panel-name" id="headerPanelName">Send Request</div>
      <div class="header-spacer"></div>
      <div class="header-status">
        <div class="status-dot" id="connDot"></div>
        <span id="connLabel">Checking...</span>
      </div>
      <div class="header-divider"></div>
      <div class="header-clock" id="liveClock"></div>
    </header>

    <!-- CONTENT -->
    <div class="content">

      <!-- â•â• PANEL: SEND â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel active" id="panel-send">
        <div class="send-wrap">
          <div class="send-card" id="sendCard">

            <!-- Form -->
            <div id="formState">
              <div class="send-title">New Review Request</div>
              <div class="send-subtitle">Send a text to your customer asking for a Google review.</div>

              <form id="reviewForm" autocomplete="off" novalidate>
                <div class="float-group">
                  <input class="float-input" type="text" id="customerName" placeholder="First Name" maxlength="50" autocomplete="off" required>
                  <label class="float-label" for="customerName">Customer First Name</label>
                </div>

                <div class="float-group">
                  <input class="float-input" type="tel" id="customerPhone" placeholder="Phone Number" maxlength="14" autocomplete="off" required>
                  <label class="float-label" for="customerPhone">Phone Number</label>
                </div>

                <div class="float-group">
                  <div class="select-wrap">
                    <select class="float-select" id="serviceType">
                      <option value="General Repair">General Repair</option>
                      <option value="Oil Change">Oil Change</option>
                      <option value="Brakes">Brakes</option>
                      <option value="Diagnostics">Diagnostics</option>
                      <option value="Tires">Tires</option>
                      <option value="Inspection">Inspection</option>
                      <option value="Other">Other</option>
                    </select>
                    <label class="float-label" for="serviceType">Service Performed</label>
                  </div>
                </div>

                <button type="submit" class="send-btn" id="sendBtn">ğŸ“² Send Review Request</button>
              </form>

              <div class="error-banner" id="errorBanner"></div>
            </div>

            <!-- Success state -->
            <div class="success-state" id="successState">
              <div class="success-icon">âœ…</div>
              <div class="success-name" id="successName"></div>
              <div class="success-msg" id="successMsg"></div>
              <button class="send-another-btn" onclick="resetForm()">+ Send Another Request</button>
            </div>

          </div>
        </div>
      </div>

      <!-- â•â• PANEL: DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-dashboard">

        <!-- Stats -->
        <div class="stats-row" style="margin-bottom:20px">
          <div class="stat-card stat-card-blue">
            <div class="stat-glow"></div>
            <div class="stat-icon">ğŸ“¨</div>
            <div class="stat-value" id="stat-total">â€”</div>
            <div class="stat-label">Sent This Month</div>
          </div>
          <div class="stat-card stat-card-gold">
            <div class="stat-glow"></div>
            <div class="stat-icon">â­</div>
            <div class="stat-value" id="stat-reviewed">â€”</div>
            <div class="stat-label">Reviews In</div>
          </div>
          <div class="stat-card stat-card-orange">
            <div class="stat-glow"></div>
            <div class="stat-icon">â³</div>
            <div class="stat-value" id="stat-pending">â€”</div>
            <div class="stat-label">Pending Follow-ups</div>
          </div>
          <div class="stat-card stat-card-green">
            <div class="stat-glow"></div>
            <div class="stat-icon">ğŸ“ˆ</div>
            <div class="stat-value" id="stat-rate">â€”</div>
            <div class="stat-label">Conversion Rate</div>
          </div>
        </div>

        <div class="dash-layout">
          <!-- Table -->
          <div class="dash-main">
            <div class="table-card">
              <div class="table-header">
                <div>
                  <div class="table-title">Recent Requests</div>
                  <div class="table-meta" id="lastRefreshNote">Loading...</div>
                </div>
                <div class="table-actions">
                  <button class="btn-sm btn-ghost" onclick="exportCsv()">â¬‡ CSV</button>
                  <button class="btn-sm btn-primary" onclick="loadDashboard()">â†º Refresh</button>
                </div>
              </div>
              <table>
                <thead>
                  <tr>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Service</th>
                    <th>Date Sent</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="tableBody">
                  <tr><td colspan="6"><div class="table-empty"><div class="table-empty-icon">â³</div><div class="table-empty-msg">Loading records...</div></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Activity feed -->
          <div class="dash-aside">
            <div class="activity-card">
              <div class="activity-header">
                <span>Recent Activity</span>
                <span style="font-size:0.7rem;color:var(--text4);font-weight:500">Last 10 events</span>
              </div>
              <div class="activity-list" id="activityList">
                <div class="activity-empty">No activity yet</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- â•â• PANEL: CUSTOMERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-customers">
        <div class="customers-wrap">
          <div class="table-card">
            <div class="table-header">
              <div>
                <div class="table-title">All Customers</div>
                <div class="table-meta" id="customersCount">All time</div>
              </div>
              <div class="table-actions">
                <button class="btn-sm btn-ghost" onclick="exportCsv()">â¬‡ Export CSV</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Phone</th>
                  <th>Service</th>
                  <th>Date Sent</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="allTableBody">
                <tr><td colspan="6"><div class="table-empty"><div class="table-empty-icon">ğŸ‘¥</div><div class="table-empty-msg">Loading...</div></div></td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- â•â• PANEL: SETTINGS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="panel" id="panel-settings">
        <div class="settings-wrap">

          <div class="settings-card">
            <h3>âš™ï¸ Mac Mini Connection</h3>
            <p>Set the local network IP address of your Mac mini. You only need to do this once. The app saves it automatically.</p>
            <div class="settings-row">
              <div class="float-group">
                <input class="float-input" type="text" id="settingsIp" placeholder="IP Address" autocomplete="off">
                <label class="float-label" for="settingsIp">Mac Mini IP Address</label>
              </div>
              <div class="float-group" style="flex:0 0 auto;margin-bottom:0">
                <input class="float-input" type="text" id="settingsPort" placeholder="Port" style="width:90px" autocomplete="off">
                <label class="float-label" for="settingsPort">Port</label>
              </div>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <button class="btn-sm btn-primary" onclick="saveSettings()">ğŸ’¾ Save Settings</button>
              <button class="btn-sm btn-ghost" onclick="testConnection()">ğŸ”Œ Test Connection</button>
            </div>
            <div class="ping-result" id="pingResult"></div>
          </div>

          <div class="settings-card">
            <h3>ğŸ“‹ Current Configuration</h3>
            <p>What the app is currently using to connect.</p>
            <div class="config-display" id="configDisplay">Loading...</div>
          </div>

          <div class="settings-card">
            <h3>ğŸ“± Review Link</h3>
            <p>The Google review link sent to customers via text message.</p>
            <div class="config-display">
              <span class="config-key">URL:  </span><span class="config-val">https://g.page/r/CXq8b_a9JviMEAE/review</span>
            </div>
          </div>

        </div>
      </div>

    </div><!-- /content -->
  </div><!-- /main -->
</div><!-- /shell -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG â€” loaded from localStorage or defaults
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getConfig(){
  return{
    ip:   localStorage.getItem('upfront_ip')   || '192.168.1.100',
    port: localStorage.getItem('upfront_port') || '3999',
  };
}
function base(){const c=getConfig();return`http://${c.ip}:${c.port}`}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE CLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateClock(){
  const now=new Date();
  document.getElementById('liveClock').textContent=
    now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'})+
    ' Â· '+now.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit',second:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONNECTION CHECK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let isConnected=false;
async function checkConnection(){
  try{
    const r=await fetch(`${base()}/health`,{signal:AbortSignal.timeout(3000)});
    isConnected=r.ok;
  }catch{isConnected=false}
  const dot=document.getElementById('connDot');
  const lbl=document.getElementById('connLabel');
  dot.className='status-dot'+(isConnected?'':' offline');
  lbl.textContent=isConnected?'Connected':'Offline';
}
checkConnection();
setInterval(checkConnection,30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL SWITCHING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const panelNames={send:'Send Request',dashboard:'Dashboard',customers:'All Customers',settings:'Settings'};
let dashTimer=null;
let allRecords=[];
let activityLog=[];

function switchPanel(name){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
  document.getElementById(`panel-${name}`).classList.add('active');
  document.getElementById(`nav-${name}`).classList.add('active');
  document.getElementById('headerPanelName').textContent=panelNames[name];

  clearInterval(dashTimer);dashTimer=null;

  if(name==='dashboard'){
    loadDashboard();
    dashTimer=setInterval(loadDashboard,60000);
  }
  if(name==='customers') loadCustomers();
  if(name==='settings')  loadSettingsForm();
  if(name==='send') setTimeout(()=>document.getElementById('customerName').focus(),100);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FLOATING LABELS â€” select fix
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const sel=document.getElementById('serviceType');
sel.classList.add('has-value');
sel.addEventListener('change',()=>sel.classList.add('has-value'));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PHONE FORMAT  â†’  (207) 555-1234
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('customerPhone').addEventListener('input',function(e){
  let v=e.target.value.replace(/\D/g,'').slice(0,10);
  if(v.length>6)      v=`(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6)}`;
  else if(v.length>3) v=`(${v.slice(0,3)}) ${v.slice(3)}`;
  else if(v.length)   v=`(${v}`;
  e.target.value=v;
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEND FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('reviewForm').addEventListener('submit',async function(e){
  e.preventDefault();
  const name=document.getElementById('customerName').value.trim();
  const phone=document.getElementById('customerPhone').value.trim();
  const service=document.getElementById('serviceType').value;
  const errBanner=document.getElementById('errorBanner');

  errBanner.classList.remove('show');

  if(!name){
    showErr('Please enter the customer\'s first name.');
    document.getElementById('customerName').focus();return;
  }
  const digits=phone.replace(/\D/g,'');
  if(digits.length<10){
    showErr('Please enter a valid 10-digit phone number.');
    document.getElementById('customerPhone').focus();return;
  }

  const btn=document.getElementById('sendBtn');
  btn.disabled=true;
  btn.textContent='â³ Sending...';

  try{
    const res=await fetch(`${base()}/send-review`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name,phone,service})
    });
    const data=await res.json();
    if(res.ok && data.success){
      showSuccess(name,service);
      addActivity('green',`Text sent to ${name} (${service})`);
    }else{
      showErr(data.error||'Something went wrong. Try again.');
    }
  }catch(err){
    showErr(`Can't reach the Mac mini. Check that the review server is running.\n${err.message}`);
  }finally{
    btn.disabled=false;
    btn.textContent='ğŸ“² Send Review Request';
  }
});

function showErr(msg){
  const b=document.getElementById('errorBanner');
  b.textContent='âš ï¸ '+msg;
  b.classList.add('show');
}

function showSuccess(name,service){
  document.getElementById('formState').style.display='none';
  const ss=document.getElementById('successState');
  ss.classList.add('show');
  document.getElementById('successName').textContent=`âœ… Text sent to ${name}!`;
  document.getElementById('successMsg').textContent=`${name} will receive a review request for their ${service}. A follow-up will go out in 48 hours if they haven't responded.`;
  launchConfetti();
}

function resetForm(){
  document.getElementById('reviewForm').reset();
  document.getElementById('serviceType').classList.add('has-value');
  document.getElementById('errorBanner').classList.remove('show');
  document.getElementById('formState').style.display='';
  document.getElementById('successState').classList.remove('show');
  setTimeout(()=>document.getElementById('customerName').focus(),50);
}

window.addEventListener('load',()=>document.getElementById('customerName').focus());

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadDashboard(){
  try{
    const[rv,st]=await Promise.all([
      fetch(`${base()}/reviews`),
      fetch(`${base()}/stats`)
    ]);
    if(!rv.ok) throw new Error('reviews fetch failed');
    allRecords=await rv.json();
    renderTable(allRecords,'tableBody',20);

    if(st.ok){
      const s=await st.json();
      animateCount('stat-total',   s.totalThisMonth??0);
      animateCount('stat-reviewed',s.reviewed??0);
      animateCount('stat-pending', s.pending??0);
      document.getElementById('stat-rate').textContent=
        s.conversionRate!=null?`${s.conversionRate}%`:'â€”';
    }

    document.getElementById('lastRefreshNote').textContent=
      `Updated ${new Date().toLocaleTimeString()} Â· auto-refreshes every 60s`;
  }catch(err){
    document.getElementById('tableBody').innerHTML=`
      <tr><td colspan="6"><div class="table-empty">
        <div class="table-empty-icon">âš ï¸</div>
        <div class="table-empty-msg">Can't connect to Mac mini</div>
        <div class="table-empty-sub">${err.message}</div>
      </div></td></tr>`;
    document.getElementById('lastRefreshNote').textContent='Connection failed';
  }
}

async function loadCustomers(){
  try{
    const rv=await fetch(`${base()}/reviews`);
    if(!rv.ok) throw new Error('failed');
    const records=await rv.json();
    renderTable(records,'allTableBody',9999);
    document.getElementById('customersCount').textContent=`${records.length} customer${records.length===1?'':'s'} all time`;
  }catch(err){
    document.getElementById('allTableBody').innerHTML=`
      <tr><td colspan="6"><div class="table-empty">
        <div class="table-empty-icon">âš ï¸</div>
        <div class="table-empty-msg">Could not load customers</div>
        <div class="table-empty-sub">${err.message}</div>
      </div></td></tr>`;
  }
}

function renderTable(records,tbodyId,limit){
  const tbody=document.getElementById(tbodyId);
  if(!records||records.length===0){
    tbody.innerHTML=`<tr><td colspan="6"><div class="table-empty">
      <div class="table-empty-icon">ğŸ“­</div>
      <div class="table-empty-msg">No records yet</div>
      <div class="table-empty-sub">Send your first review request to get started.</div>
    </div></td></tr>`;
    return;
  }
  const sorted=[...records].sort((a,b)=>new Date(b.sentAt)-new Date(a.sentAt)).slice(0,limit);
  tbody.innerHTML=sorted.map((r,i)=>{
    const delay=Math.min(i*0.04,0.5);
    const canMark=r.status!=='reviewed';
    return`<tr style="animation-delay:${delay}s">
      <td class="td-name" data-label="Customer">${esc(r.name)}</td>
      <td class="td-phone" data-label="Phone">${esc(r.phone)}</td>
      <td data-label="Service">${esc(r.service)}</td>
      <td class="td-date" data-label="Date">${fmtDate(r.sentAt)}</td>
      <td data-label="Status">${badge(r.status)}</td>
      <td data-label="Action"><button class="mark-btn" ${canMark?'':' disabled'}
        onclick="markReviewed('${esc(r.id)}','${esc(r.name)}',this)">
        ${r.status==='reviewed'?'âœ… Reviewed':'âœ… Mark Reviewed'}
      </button></td>
    </tr>`;
  }).join('');
}

function badge(status){
  const m={
    pending:   ['badge-pending',   'ğŸŸ¡','Pending'],
    followed:  ['badge-followed',  'ğŸ”','Followed Up'],
    reviewed:  ['badge-reviewed',  'âœ…','Reviewed'],
    noresponse:['badge-noresponse','âŒ','No Response'],
  };
  const[cls,icon,lbl]=m[status]||m.pending;
  return`<span class="badge ${cls}">${icon} ${lbl}</span>`;
}

function fmtDate(iso){
  if(!iso) return'â€”';
  const d=new Date(iso);
  return d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})+
         ' '+d.toLocaleTimeString('en-US',{hour:'numeric',minute:'2-digit'});
}

function esc(s){
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MARK REVIEWED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function markReviewed(id,name,btn){
  if(!confirm(`Mark ${name} as reviewed?`)) return;
  btn.disabled=true;btn.textContent='â³...';
  try{
    const res=await fetch(`${base()}/mark-reviewed`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({id})
    });
    const data=await res.json();
    if(res.ok&&data.success){
      addActivity('green',`Marked reviewed: ${name}`);
      loadDashboard();
    }else{
      alert(data.error||'Error marking as reviewed');
      btn.disabled=false;btn.textContent='âœ… Mark Reviewed';
    }
  }catch(err){
    alert(`Connection error: ${err.message}`);
    btn.disabled=false;btn.textContent='âœ… Mark Reviewed';
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVITY FEED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addActivity(color,text){
  activityLog.unshift({color,text,time:new Date()});
  if(activityLog.length>10) activityLog.pop();
  renderActivity();
}

function renderActivity(){
  const el=document.getElementById('activityList');
  if(!activityLog.length){el.innerHTML='<div class="activity-empty">No activity yet</div>';return}
  el.innerHTML=activityLog.map((a,i)=>`
    <div class="activity-item" style="animation-delay:${i*0.04}s">
      <div class="activity-text">
        <span class="activity-dot dot-${a.color}"></span>${esc(a.text)}
      </div>
      <div class="activity-time">${relTime(a.time)}</div>
    </div>`).join('');
}

function relTime(d){
  const s=Math.floor((Date.now()-new Date(d))/1000);
  if(s<10) return'just now';
  if(s<60) return`${s}s ago`;
  if(s<3600) return`${Math.floor(s/60)}m ago`;
  return`${Math.floor(s/3600)}h ago`;
}

setInterval(renderActivity,30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT CSV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportCsv(){
  if(!allRecords||!allRecords.length){alert('No data to export.');return}
  const hdr=['Name','Phone','Service','Date Sent','Status'];
  const rows=allRecords.map(r=>[r.name,r.phone,r.service,
    r.sentAt?new Date(r.sentAt).toLocaleString():'',r.status]);
  const csv=[hdr,...rows]
    .map(r=>r.map(c=>`"${String(c||'').replace(/"/g,'""')}"`).join(','))
    .join('\n');
  const a=Object.assign(document.createElement('a'),{
    href:URL.createObjectURL(new Blob([csv],{type:'text/csv'})),
    download:`upfront-reviews-${new Date().toISOString().slice(0,10)}.csv`
  });
  a.click();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NUMBER COUNT-UP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function animateCount(id,target){
  const el=document.getElementById(id);
  const start=parseInt(el.textContent)||0;
  const dur=800,fps=60,steps=Math.ceil(dur/1000*fps);
  let step=0;
  const tick=setInterval(()=>{
    step++;
    el.textContent=Math.round(start+(target-start)*(step/steps));
    if(step>=steps){el.textContent=target;clearInterval(tick)}
  },1000/fps);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function loadSettingsForm(){
  const c=getConfig();
  const ipEl=document.getElementById('settingsIp');
  const portEl=document.getElementById('settingsPort');
  ipEl.value=c.ip;
  portEl.value=c.port;
  // Trigger floating label
  if(c.ip) ipEl.dispatchEvent(new Event('input'));
  if(c.port) portEl.dispatchEvent(new Event('input'));
  updateConfigDisplay();
}

function saveSettings(){
  const ip=document.getElementById('settingsIp').value.trim();
  const port=document.getElementById('settingsPort').value.trim();
  if(!ip){alert('Please enter an IP address.');return}
  localStorage.setItem('upfront_ip',ip);
  localStorage.setItem('upfront_port',port||'3999');
  updateConfigDisplay();
  checkConnection();
  const btn=event.target;
  btn.textContent='âœ… Saved!';
  setTimeout(()=>btn.textContent='ğŸ’¾ Save Settings',2000);
}

async function testConnection(){
  const pr=document.getElementById('pingResult');
  pr.className='ping-result';pr.textContent='Testing...';pr.style.display='block';
  const t0=Date.now();
  try{
    const r=await fetch(`${base()}/health`,{signal:AbortSignal.timeout(5000)});
    const ms=Date.now()-t0;
    if(r.ok){
      pr.className='ping-result ok';
      pr.textContent=`âœ… Connected! Response time: ${ms}ms`;
    }else{
      pr.className='ping-result fail';
      pr.textContent=`âŒ Server responded with error ${r.status}`;
    }
  }catch(err){
    pr.className='ping-result fail';
    pr.textContent=`âŒ No connection â€” ${err.message}`;
  }
}

function updateConfigDisplay(){
  const c=getConfig();
  document.getElementById('configDisplay').innerHTML=
    `<span class="config-key">IP:    </span><span class="config-val">${c.ip}</span>\n`+
    `<span class="config-key">Port:  </span><span class="config-val">${c.port}</span>\n`+
    `<span class="config-key">URL:   </span><span class="config-val">http://${c.ip}:${c.port}</span>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function launchConfetti(){
  const canvas=document.getElementById('confettiCanvas');
  const ctx=canvas.getContext('2d');
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;

  const colors=['#e63946','#2ecc71','#3b82f6','#f39c12','#8b5cf6','#ffffff','#fbbf24'];
  const pieces=[];
  for(let i=0;i<120;i++){
    pieces.push({
      x:Math.random()*canvas.width,
      y:-10-Math.random()*100,
      w:6+Math.random()*8,
      h:4+Math.random()*6,
      color:colors[Math.floor(Math.random()*colors.length)],
      angle:Math.random()*360,
      spin:4-Math.random()*8,
      vx:-3+Math.random()*6,
      vy:4+Math.random()*6,
      alpha:1,
    });
  }

  let frame=0;
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{
      ctx.save();
      ctx.globalAlpha=p.alpha;
      ctx.fillStyle=p.color;
      ctx.translate(p.x,p.y);
      ctx.rotate(p.angle*Math.PI/180);
      ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
      p.x+=p.vx;p.y+=p.vy;
      p.angle+=p.spin;p.vy+=0.12;
      if(frame>60) p.alpha-=0.012;
    });
    frame++;
    if(pieces.some(p=>p.alpha>0)) requestAnimationFrame(draw);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  }
  draw();
}
</script>
</body>
</html>
